
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Patrik Svensson - An introduction to Spectre.Cli</title>
        <meta name="description" content="Patrik Svensson" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Patrik Svensson" href="/rss.xml" />
                <link type="application/atom+xml" rel="alternate" title="Patrik Svensson" href="/feed.xml" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Patrik Svensson" />
        <meta name="msapplication-tooltip" content="Patrik Svensson" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Patrik Svensson - An introduction to Spectre.Cli" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://patriksvensson.se/2018/04/an-introduction-to-spectre-cli" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        


        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Patrik Svensson</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                <li><a href="/blog">Archive</a></li>
<li><a href="/tags">Tags</a></li> 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>An introduction to Spectre.Cli</h1>
    <div class="meta">        
Published on 10 april 2018<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/c%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/tags/cli" class="btn btn-default btn-xs">CLI</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<p>I've been writing a lot of CLI apps, both at work and in my free time, and there's never really
been a command line parsing framework that has fitted my needs. While being either too complex
or too simple, it's always nagged me that I need to write so much code myself. What I wanted
was a way to be declarative about my commands, options and arguments while still allowing
composition of them.</p>
<p>So a year back or something like that I decided to build a small framework upon
<code>Microsoft.Extensions.CommandLineUtils</code> that would allow me to write my applications like I wanted to,
and it worked great (although with a lot of duct tape).</p>
<p>That was until I ran into bugs and other annoyances in the underlying library and discovered
that they didn't accept any pull request since the library was stable for their needs
and not under active development. So I decided to rip out Microsoft's library and replace
it with something else, and <a href="https://github.com/spectresystems/spectre.cli">Spectre.Cli</a> was born.</p>
<h2 id="how-does-it-work">How does it work?</h2>
<p>The underlying philosophy behing Spectre.Cli is to rely on the .NET type system to
declare the commands, but tie everything together via composition.</p>
<p>Imagine the following command structure:</p>
<ul>
<li>dotnet <em>(executable)</em>
<ul>
<li>add <code>[PROJECT]</code>
<ul>
<li>package <code>&lt;PACKAGE_NAME&gt;</code></li>
<li>reference <code>&lt;PROJECT_REFERENCE&gt;</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>For this I would like to implement the commands (the different levels in the tree that
executes something) separately from the settings (the options, flags and arguments),
which I want to be able to inherit from each other.</p>
<pre><code class="language-csharp">public class AddSettings : CommandSettings
{
    [CommandArgument(0, &quot;[PROJECT]&quot;)]
    public string Project { get; set; }
}

public class AddPackageSettings : AddSettings
{
    [CommandArgument(0, &quot;&lt;PACKAGE_NAME&gt;&quot;)]
    public string PackageName { get; set; }

    [CommandOption(&quot;-v|--version &lt;VERSION&gt;&quot;)]
    public string Version { get; set; }
}

public class AddReferenceSettings : AddSettings
{
    [CommandArgument(0, &quot;&lt;PROJECT_REFERENCE&gt;&quot;)]
    public string ProjectReference { get; set; }
}
</code></pre>
<pre><code class="language-csharp">public class AddPackageCommand : Command&lt;AddPackageSettings&gt;
{
    public override int Execute(AddPackageSettings settings, ILookup&lt;string, string&gt; remaining)
    {
        // Omitted
    }
}

public class AddReferenceCommand : Command&lt;AddReferenceSettings&gt;
{
    public override int Execute(AddReferenceSettings settings, ILookup&lt;string, string&gt; remaining)
    {
        // Omitted
    }
}
</code></pre>
<p>Now when we have our commands and settings implemented, we can compose a command tree
that tells the parser how to interpret user input.</p>
<pre><code class="language-csharp">using Spectre.Cli;

namespace MyApp
{
    public static class Program
    {
        public static int Main(string[] args)
        {
            var app = new CommandApp();

            app.Configure(config =&gt;
            {
                config.AddBranch&lt;AddSettings&gt;(&quot;add&quot;, add =&gt;
                {
                    add.AddCommand&lt;AddPackageCommand&gt;(&quot;package&quot;);
                    add.AddCommand&lt;AddReferenceCommand&gt;(&quot;reference&quot;);
                });
            });

            return app.Run(args);
        }
    }
}
</code></pre>
<p>Now you might wonder, why do things like this? Well, for starters the different parts
of the application are separated, while still having the option to share things like options,
flags and arguments between them.</p>
<p>This make the resulting code very clean and easy to navigate, not to mention to unit test.
And most importantly at all, the type system guides me to do the right thing. I can't configure
commands in non-compatible ways, and if I want to add a new top-level <code>add-package</code> command
(or move the command completely), it's just a single line to change. This makes it easy to
experiment and makes the CLI experience a first class citizen of your application.</p>
<h2 id="errors">Errors</h2>
<p>I've also put some time in making the help screens and errors more intuitive than most other
command line parsing frameworks.</p>
<p><img src="/images/command_help.png" class="img-fluid" alt="Help" /><br />
<img src="/images/command_error.png" class="img-fluid" alt="Error" /></p>
<h2 id="what-else">What else?</h2>
<p>This article was meant as an introduction to Spectre.Cli, but the framework itself contains a
lot of other things as well such as dependency injection, validation and async/await support.
More about that in a later blog post!</p>
<p>If you want to see Spectre.Cli in action I recommend you to take a look at the
<a href="https://github.com/spectresystems/spectre.cli/tree/develop/samples">sample applications</a> in the
source code repository.</p>



                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
        <div class="row">
                <div class="col-md-12">
                <ul class="list-inline text-center">
                        <li>
                        <a href="https://twitter.com/firstdrafthell">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                        <li>
                        <a href="https://github.com/patriksvensson">
                                <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                        </a>
                        </li>
                </ul>
                <p class="copyright text-muted">
                        Blog originally forked from <a href="https://github.com/gep13/gep13">https://github.com/gep13/gep13</a><br />
                        This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                        <br />
                        <a href="/rss.xml"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.xml"><i class="fa fa-rss"></i> Atom Feed</a>
                        <br />
                        <a href="https://github.com/patriksvensson/blog"><i class="fa fa-github"></i> This Site on GitHub</a> | <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
                </p>
                </div>
        </div>
</div>
                </footer> 

                <script type="text/javascript" src="/assets/js/anchor.min.js"></script>
<script type="text/javascript" src="/assets/js/clipboard.min.js"></script>
<script type="text/javascript">
    anchors.options.placement = 'left';
    anchors.add();

    var snippets = document.querySelectorAll("pre > code");
    [].forEach.call(snippets, function(snippet) {
        snippet.insertAdjacentHTML("beforebegin", "<button class='btn-copy' data-clipboard-snippet><img class='clippy' width=13 src='/assets/images/clippy.svg' alt='Copy to clipboard'></button>");
    });
    var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
        target: function(trigger) {
            return trigger.nextElementSibling;
        }
    });
    clipboardSnippets.on('success', function(e) {
        e.clearSelection();
        showTooltip(e.trigger, "Copied!");
    });
    clipboardSnippets.on('error', function(e) {
        showTooltip(e.trigger, fallbackMessage(e.action));
    });
</script>

<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-53005417-1', 'auto');
    ga('send', 'pageview');

</script>
                <script>hljs.initHighlightingOnLoad();</script>

                        <script type="text/javascript">                
                                // Header background                        
                                var colors = Please.make_color({
                                        colors_returned: 3,
                                        saturation: .6
                                });
                                var t = new Trianglify({
                                        x_gradient: colors,
                                        y_gradient: ["#FFFFFF"]
                                });
                                var header = document.getElementById("intro-header");
                                var pattern = t.generate(header.clientWidth, header.clientHeight);
                                header.setAttribute('style', 'background-image: ' + pattern.dataUrl);                        
                        </script>

                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

